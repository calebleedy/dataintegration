\documentclass[12pt]{article}

\usepackage{amsmath, amssymb, mathrsfs, fancyhdr}
\usepackage{syntonly, lastpage, hyperref, enumitem, graphicx}
\usepackage{biblatex}
\usepackage{booktabs}
\usepackage{float}

\addbibresource{references.bib}

\hypersetup{colorlinks = true, urlcolor = black}

\headheight     15pt
\topmargin      -1.5cm   % read Lamport p.163
\oddsidemargin  -0.04cm  % read Lamport p.163
\evensidemargin -0.04cm  % same as oddsidemargin but for left-hand pages
\textwidth      16.59cm
\textheight     23.94cm
\parskip         7.2pt   % sets spacing between paragraphs
\parindent         0pt   % sets leading space for paragraphs
\pagestyle{empty}        % Uncomment if don't want page numbers
\pagestyle{fancyplain}

\newcommand{\MAP}{{\text{MAP}}}
\newcommand{\argmax}{{\text{argmax}}}
\newcommand{\argmin}{{\text{argmin}}}
\newcommand{\logistic}{{\text{logistic}}}


\begin{document}

%\lhead{Caleb Leedy}
\chead{Nonmonotone Missingness}
%\chead{STAT 615 - Advanced Bayesian Methods}
%\rhead{Page \thepage\ of \pageref{LastPage}}
\rhead{April 4, 2023}

\section*{Overview:}

The goal of this project is to outperform existing techniques in the literature
related to nonmonotone missing data.

\section*{Completed:}

\begin{itemize}
  \item \textbf{Implemented simulation of monotone MAR data}: This is 
  correspondingly easier
  than the subsequent nonmonotone MAR simulation. For this simulation we use the 
  following approach:
  \begin{enumerate}
      \item Generate $X$, $Y_1$, and $Y_2$ for elements $i = 1, \dots, n$.
      \item Using the covariate $X$, determine the probability $p_1$ of $Y_1$
      being observed for each element $i$.
      \item Based on $p_1$, determine if $R_1 = 1$.
      \item If $R_1 = 0$, then $R_2 = 0$. Otherwise, using variables $X$ and $Y_1$,
      determine the probability $p_{12}$.
      \item Based on $p_{12}$ determine if $R_2 = 1$.
  \end{enumerate}
  At the end of the algorithm, we have determined the values of binary variables 
  $R_1$ and $R_2$ for each $i$ and if either of them are equal to 1, the corresponding
  level of $Y_{k}$. As is common in this literature, the values of $R_1$ and $R_2$
  determine if the corresponding variable $Y_1$ or $Y_2$ is missing or observed
  with $R = 1$ indicating $Y$ being observed.
  
  \item \textbf{Implemented simulation of nonmonotone MAR data}: 
  Following the approach
    of \cite{robins1997non}, I construct a nonmonotone MAR simulation with two 
    response variables $Y_1$ and $Y_2$ and one covariate $X$. The algorithm to
    generate the data is the following:
    \begin{enumerate}
        \item Generate $X$, $Y_1$, and $Y_2$ for elements $i = 1, \dots, n$.
        \item Using the covariate $X_i$, generate probabilities for each element $i$
        $p_0$, $p_1$, and $p_2$ such that $p_0 + p_1 + p_2 = 1$. 
        \item Select one option based on the three probabilities for each element $i$.
        If 0 is selected: $R_1 = 0$ and $R_2 = 0$. If 1 is selected $R_1 = 1$. If 
        2 is selected, $R_2 = 1$.
        \item We take the next step in multiple cases. If 0 was selected, we are done.
        If 1 was selected, we generate probabilities $p_{12}$ based on $X$ and $Y_1$.
        Then based on this probability, we determine if $R_2 = 1$. In the same manner,
        if 2 was selected in the previous step, we generate probabilities $p_{21}$
        based on $X$ and $Y_2$. Then based on this probability, we determine if $R_2 = 1$.
    \end{enumerate}
    Like the monotone MAR simulation this algorithm produces similar final results
    with the determination of binary variables 
    $R_1$ and $R_2$ and variables $X$, $Y_1$, and $Y_2$. Unlike the monotone MAR case,
    the nonmonotone MAR includes observations with $Y_2$ observed and $Y_1$ missing.
    
    \item \textbf{Analyzed simulation from monotone MAR}:
    Following the algorithm described in the monotone MAR simulation bullet, 
    we first generate data from the following distributions:
    \begin{align*}
        X_i &\stackrel{iid}{\sim} N(0, 1) \\
        Y_{1i} &\stackrel{iid}{\sim} N(0, 1)\\
        Y_{2i} &\stackrel{iid}{\sim} N(\theta, 1)
    \end{align*}

    Then, we create the probabilities $p_1 = \logistic(x_i)$ and 
    $p_{12} = \logistic(y_{1i})$.
    Since, both $x_i$ and $y_1$ are standard normal distributions, each of these
    probabilities is approximately $0.5$ in expectation.

    The goal of this simulation is to estimate $\theta$. Alternatively, we can
    express this as solving the estimating equation:

    \[g(\theta) \equiv Y_2 - \theta = 0.\]

    We estimate $\theta$ using the following procedures:

    \begin{itemize}
        \item Oracle: This computes $\bar Y$ using \textit{both} the observed and
        missing data.
        \item IPW-Oracle: This is an IPW estimator using only the observed values
        of $Y_2$. The weights (inverse probabilities) use the actual probabilities.
        \item IPW-Est: This is an IPW estimator using the probabilities that have
        been estimated by a logistic model.
        \item Semi: This is the monotone semiparametric efficient estimator from
        Slide 11 (Equation 2) of Dr. Kim's Nonmonotone Missingness presentation.
    \end{itemize}

    We run this simulation with different values of $\theta$, sample size of 1000, and
    1000 Monte Carlo replications. Each algorithm for each replication generates
    $\hat \theta$. In the subsequent tables, we compute the bias, standard deviation (sd),
    t-statistic (where we test for a significant difference between the Monte Carlo
    mean $\hat \theta$ and the true $\theta$) and the p-value of the t-statistic.
    
    \newpage 

    \input{../Tables/monomar_t-5.tex}
    \input{../Tables/monomar_t0.tex}
    \input{../Tables/monomar_t5.tex}

    Overall, these results are mostly what I would have expected. All of the algorithms
    estimate the true value of $\theta$ correctly in each case, with the oracle 
    estimate having the smallest variance followed by the semiparametric algorithm.
    If there is anything surprising it is that the IPW estimator has better 
    performance with the estimated weights compared to the true weights. However,
    I think that this is a known phenomenon.

    \newpage 
    
    \item \textbf{Analyzed simulation from nonmonotone MAR}:
    Like the monotone simulation, we generate data using:
    \begin{align*}
        X_i &\stackrel{iid}{\sim} N(0, 1) \\
        Y_{1i} &\stackrel{iid}{\sim} N(0, 1)\\
        Y_{2i} &\stackrel{iid}{\sim} N(\theta, 1)
    \end{align*}

    However, because we have nonmonotone data, our ``Stage 1'' probabilities are
    different. We compute the true Stage 1 probabilities being proportional to the
    following values:
    
    \begin{align*}
        p_0 &\propto |x - 2|\\
        p_1 &\propto |x|\\
        p_2 &\propto |x + 2|.
    \end{align*}
    
   However, we keep the same structure for the Stage 2 probabilities with: 
   $p_{12} = \logistic(y_1)$ and $p_{21} = \logistic(y_2)$. The goal remains to estimate
   $\theta$. We continue to use the Oracle algorithm and the IPW-Oracle algorithm. Since
   we have nonmonotone MAR data, we use the ``Proposed'' algorithm that is described 
   on Slide 25 (Equation 12) of Dr. Kim's presentation. The response models and outcome
   models were estimated using logistic regression and OLS and correctly specified.
   This yields the following results:
   
    \input{../Tables/nonmonomar_t-5}
    \input{../Tables/nonmonomar_t0}
    \input{../Tables/nonmonomar_t5}

    \newpage
\end{itemize}

\section*{Todo:}

\begin{itemize}
    \item \textbf{Estimate IPW probabilities for nonmonotone MAR}:
\end{itemize}


\newpage

\printbibliography

\end{document}

